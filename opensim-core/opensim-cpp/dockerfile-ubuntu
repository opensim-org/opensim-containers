FROM stanfordnmbl/opensim-deps:4.3

LABEL maintainer="Ayman Habib"

# Build cpp only libraries and cli for opensim-core no bindings
RUN mkdir opensim_build \
    && cd opensim_build \
    && cmake ../opensim-core \
      -DCMAKE_INSTALL_PREFIX=$OPENSIM_INSTALL -DOPENSIM_DEPENDENCIES_DIR=$OPENSIM_DEPENDENCIES_HOME \
      -DOPENSIM_C3D_PARSER=ezc3d -DBUILD_TESTING=OFF \
    && make -j8 \
    && make install \
    && rm -rf ../opensim_build

RUN cp "$OPENSIM_DEPENDENCIES_HOME/adol-c/lib64/"*.* "$OPENSIM_INSTALL/lib"

# Set LD_LIBRARY_PATH so pyhton can load the shard libraries
ENV LD_LIBRARY_PATH="$LD_LIBRARY_PATH:$OPENSIM_DEPENDENCIES_HOME/simbody/lib:$OPENSIM_INSTALL/lib"
ENV PATH=$PATH:"$OPENSIM_INSTALL/bin"

# image stored at stanfordnmbl/opensim-cpp
